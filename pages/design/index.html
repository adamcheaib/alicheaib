<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Artwork</title>
    <link rel="stylesheet" href="../category_css.css">
</head>
<body>
<header>
    <a href="../3d/">3D</a>
    <a href="../artwork/">Artwork</a>
    <a href="" id="current_page">Design</a>
    <a href="../design/">Speed Art</a>
</header>
<section id="category_gallery">
    <div id="grid_container"></div>
</section>

<div id="overlay">
    <img id="dialog_img_pc"
         src="https://png.pngtree.com/thumb_back/fw800/background/20230720/pngtree-blue-and-purple-neon-star-3d-art-background-with-a-cool-image_3705286.jpg"
         alt="">
    <img id="dialog_img_phone" src="" alt="">
    <button id="to_youtube_video">
        <a id="to_youtube_container" href="https://www.google.com" target="_blank">
            Titta p√• YouTube!
        </a>
    </button>
    <div id="shadow_background"></div>
</div>

<script src="../data.js"></script>
<script>
    data.forEach(item => {
        const item_data = item.get_info();

        const parent_div = document.createElement("div");
        parent_div.classList.add(...["item_container", "hidden"]);

        const icon_img = document.createElement("img");
        icon_img.className = "creation";
        icon_img.src = item_data.phone_img;
        icon_img.dataset.pc_img = item_data.pc_img;

        const youtube_icon_container = document.createElement("a");
        youtube_icon_container.target = "_blank";

        const youtube_icon = document.createElement("img");
        youtube_icon.src = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRCE8Ofe3duyxd5_LVklR-R-vql2jCiX_LtUw&s";

        youtube_icon_container.appendChild(youtube_icon);

        parent_div.appendChild(icon_img);
        if (item_data.video !== false) {
            youtube_icon_container.href = item_data.video;
            parent_div.appendChild(youtube_icon_container);
        }

        document.getElementById("grid_container").appendChild(parent_div);

    })

    const all_images = document.querySelectorAll(".item_container");
    const overlay = document.getElementById("overlay");
    const overlay_img_pc = overlay.querySelector("#dialog_img_pc");
    const overlay_img_phone = overlay.querySelector("#dialog_img_phone");
    const overlay_shadow_background = document.getElementById("shadow_background");
    const overlay_to_youtube = overlay.querySelector("button");
    const header = document.querySelector("header");

    let negative_header = "-100px";
    let positive_header = "0px";

    overlay_shadow_background.onclick = close_overlay;

    function close_overlay(event) {
        overlay.style.visibility = "hidden";
        header.style.visibility = "visible";
        overlay.style.backdropFilter = "blur(0)";
        overlay_img_pc.style.opacity = 0;
        overlay_img_phone.style.opacity = 0;
        document.body.classList.toggle("prevent_scroll");
    }

    function show_overlay(event) {
        if (event.target.className === "creation") {
            document.body.classList.toggle("prevent_scroll");
            overlay.style.backdropFilter = "blur(10px)";
            header.style.visibility = "hidden";
            overlay.style.visibility = "visible";
            overlay_img_pc.src = event.target.dataset.pc_img;
            overlay_img_pc.style.opacity = 1;

            const img_file_name = event.target.src.replace("mobile_imgs", "dialog_view");
            console.log(img_file_name);

            overlay_img_phone.src = img_file_name;
            console.log(event.target.src);
            overlay_img_phone.style.opacity = 1;

            const item_video = event.currentTarget.querySelector("a");

            if (item_video !== null) {
                overlay.querySelector("a").href = item_video.href;
                overlay_to_youtube.style.display = "";
            } else {
                overlay_to_youtube.style.display = "none";
            }
        }

    }

    all_images.forEach(item => {
        item.style.opacity = 0;
        item.onclick = show_overlay;

        function show_image(target) {
            let image_showing = target[0].isIntersecting;

            if (image_showing === true) {
                item.classList.remove("hidden");
                item.classList.add("shown");
            }
        }

        const ob = new IntersectionObserver(show_image);
        ob.observe(item);

    })
    let previous_window_scroll = window.scrollY;
    let scroll_timeout;
    window.onscroll = () => {
        clearTimeout(scroll_timeout)
        if (window.scrollY > previous_window_scroll) {
            header.style.top = negative_header;
            setTimeout(() => previous_window_scroll = window.scrollY, 200);
            scroll_timeout = setTimeout(() => header.style.top = "0", 100);
        } else {
            header.style.top = positive_header;
            previous_window_scroll = window.scrollY;
        }
    }

</script>
</body>
</html>